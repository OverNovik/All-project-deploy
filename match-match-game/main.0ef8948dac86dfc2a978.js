(()=>{"use strict";var e={309:(e,t,s)=>{s.r(t)},76:(e,t,s)=>{s.r(t)},80:(e,t,s)=>{s.r(t)},850:(e,t,s)=>{s.r(t)},526:(e,t,s)=>{s.r(t)},336:(e,t,s)=>{s.r(t)},528:(e,t,s)=>{s.r(t)},171:(e,t,s)=>{s.r(t)},667:(e,t,s)=>{s.r(t)},580:(e,t,s)=>{s.r(t)},373:(e,t,s)=>{s.r(t)},752:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const i=s(977),n=s(0),a=s(743);t.App=class{constructor(e){this.rootElement=e,this.header=new i.Header,this.main=new a.Main,this.footer=new n.Footer,this.rootElement.appendChild(this.header.element),this.rootElement.appendChild(this.main.element),this.rootElement.appendChild(this.footer.element)}}},366:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AboutGame=void 0,s(309);const i=s(583);class n extends i.BaseComponent{constructor(){super("div",["about-game"]),this.element.innerHTML='\n    <div class="about-game__block__request">\n      <h1 class="about-game__block__request_title">How to play?</h1>\n      <ol>\n        <li class="request__one">Register new player in game</li>\n        <li class="request__two">Configure your game settings</li>\n        <li class="request__three">\n        Start you new game! Remember card positions and match it before times up.\n        </li>\n      </ol>\n    </div>\n    <div class="about-game__settings">\n      <div class="about-game__registr"></div>\n      <a href="#/game-settings" class="menu__link">Game Settings</a>\n      <div class="about-game__example"></div>\n    </div>\n    '}}t.AboutGame=n},583:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseComponent=void 0,t.BaseComponent=class{constructor(e="div",t=[]){this.element=document.createElement(e),this.element.classList.add(...t)}}},186:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BestScore=void 0;const i=s(583),n=s(874);class a extends i.BaseComponent{constructor(){super("div",["best-score"]),this.users=[],this.userService=new n.UserService,this.userService.getAll((e=>{this.users=e})),this.element.innerHTML=`\n    <h1>Best Score</h1>\n    <ol class="best-score__list">\n      <li class="best-score__list_item">${this.users}</li>\n    </ol>\n    `}}t.BestScore=a},343:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Card=void 0,s(76);const i=s(583);class n extends i.BaseComponent{constructor(e){super("div",["card-container"]),this.image=e,this.isFlipped=!1,this.element.innerHTML=`\n      <div class="card">\n        <div class="card__front" style="background-image: url('./images/${e}')"></div>\n        <div class="card__back"></div>\n      </div>\n    `}flipToBack(){this.isFlipped=!0,this.flip(!0)}flipToFront(){this.isFlipped=!1,this.flip()}flip(e=!1){return new Promise((t=>{this.element.classList.toggle("flipped",e),this.element.addEventListener("transitionend",(()=>t()),{once:!0})}))}}t.Card=n},610:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CardsField=void 0,s(80);const i=s(583);class n extends i.BaseComponent{constructor(){super("div",["cards-field"]),this.cards=[]}clear(){this.cards=[],this.element.innerHTML=""}addCards(e){this.cards=e,this.cards.forEach((e=>this.element.appendChild(e.element))),setTimeout((()=>{this.cards.forEach((e=>e.flipToBack()))}),5e3)}}t.CardsField=n},0:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Footer=void 0,s(850);const i=s(583);class n extends i.BaseComponent{constructor(){super("footer",["footer"]),this.element.innerHTML="\n      <span>RS School</span> <span>2021</span>\n    "}}t.Footer=n},286:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameSettings=void 0,s(526);const i=s(583),n=s(20);class a extends i.BaseComponent{constructor(){super("div",["game-settings"]),this.gameSettings=n.localStorageUtil.getGameSettings(),this.element.innerHTML=`\n    <div class="game-settings__area">\n      <div>\n        <label for="cards">Game cards</label>\n        <select class="game-cards" name="cards">\n        <option\n        ${"sw"===this.gameSettings.cardType?"selected":""}\n        value="sw">Star wars</option>\n        <option\n        ${"animals"===this.gameSettings.cardType?"selected":""}\n         value="animals">Animals</option>\n        </select>\n      </div>\n      <div>\n        <label for="difficulty">Difficulty</label>\n        <select class="difficulty" name="difficulty">\n          <option\n          ${3===this.gameSettings.cardCount?"selected":""}\n           value="3">3x</option>\n          <option\n          ${4===this.gameSettings.cardCount?"selected":""}\n           value="4">4x</option>\n          <option\n          ${5===this.gameSettings.cardCount?"selected":""}\n          } value="5">5x</option>\n          <option\n          ${6===this.gameSettings.cardCount?"selected":""}\n          } value="6">6x</option>\n        </select>\n      </div>\n    </div>\n    `;const e=this.element.querySelector(".difficulty"),t=this.element.querySelector(".game-cards");null==e||e.addEventListener("change",(e=>{const t=+e.target.value;this.gameSettings.cardCount=t,n.localStorageUtil.setGameSettings(this.gameSettings)})),null==t||t.addEventListener("change",(e=>{const t=e.target.value;this.gameSettings.cardType=t,n.localStorageUtil.setGameSettings(this.gameSettings)}))}}t.GameSettings=a},229:function(e,t,s){var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function r(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0,s(336);const n=s(680),a=s(583),r=s(343),o=s(610),l=s(981),c=s(168),d=s(20);class u extends a.BaseComponent{constructor(){super("div",["game"]),this.imgSrc=[],this.isAnimation=!1,this.falseCount=0,this.trueCount=0,this.compareCount=0,this.timer=new l.Timer,this.cardsField=new o.CardsField,this.popupWin=new c.WinnerPopup,this.element.innerHTML='\n      <div class="match-content">\n        <h1 class="match-content__title">Click on start to start the game</h1>\n        <button type="submit" class="match-content__start_btn">Start</button>\n      </div>\n    ';const e=this.element.querySelector(".match-content__start_btn");null==e||e.addEventListener("click",(()=>{this.element.innerHTML="",this.element.appendChild(this.timer.element),this.element.appendChild(this.cardsField.element),this.element.appendChild(this.popupWin.element),this.init()}))}newGame(){this.gameSettings=d.localStorageUtil.getGameSettings();const e=this.imgSrc.slice(0,this.gameSettings.cardCount);this.cardsField.clear();const t=e.concat(e).map((e=>new r.Card(e))).sort((()=>Math.random()-.5));setTimeout(this.timer.run,5e3),t.forEach((e=>e.element.addEventListener("click",(()=>this.cardHandler(e))))),this.cardsField.addCards(t)}cardHandler(e){return i(this,void 0,void 0,(function*(){if(!this.isAnimation&&e.isFlipped){if(this.isAnimation=!0,yield e.flipToFront(),!this.activeCard)return this.activeCard=e,void(this.isAnimation=!1);this.activeCard.image===e.image&&(this.activeCard.element.style.border="5px solid green",e.element.style.border="5px solid green"),this.trueCount+=1,this.activeCard.image!==e.image&&(yield n.delay(1e3),yield Promise.all([this.activeCard.flipToBack(),e.flipToBack()]),this.falseCount+=1),this.activeCard=void 0,this.isAnimation=!1,this.checkFinishGame()}}))}checkFinishGame(){if(this.trueCount-this.falseCount===this.gameSettings.cardCount){const e=this.timer.stop();this.compareCount=100*(this.trueCount-this.falseCount)-10*e,this.popupWin.show()}}init(){return i(this,void 0,void 0,(function*(){const e=d.localStorageUtil.getGameSettings().cardType,t=yield fetch("./images.json"),s=(yield t.json()).filter((t=>t.category===e))[0];this.imgSrc=s.images.map((e=>`${s.category}/${e}`)),this.newGame()}))}}t.Game=u},977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0,s(528);const i=s(583),n=s(53),a=s(963),r=s(874);class o extends i.BaseComponent{constructor(){super("header",["header"]),this.userService=new r.UserService,a.stated.subscribe((e=>{this.currentUserId!==e.userId&&(this.currentUserId=e.userId,this.checkUser())})),this.element.innerHTML='\n      <a href="#/game" class="start-game">MATCH</a>\n      <nav class="menu-game">\n        <a href="#/about-game" class="menu__link">About Game</a>\n        <a href="#/best-score" class="menu__link">Best Score</a>\n        <a href="#/game-settings" class="menu__link">Game Settings</a>\n      </nav>\n      <div class="register">\n        <button class="menu-register">Register new player</button>\n      </div>\n      <div class="user-avatar">\n        <a href="#/about-game" class="menu__link">Stop game</a>\n        <span class="user-name"></span>\n        <img src="" height="200" width="200" class="avatar-img__head">\n      </div>\n      ',this.popup=new n.RegistrationPopup(this.userService),this.element.appendChild(this.popup.element);const e=this.element.querySelector(".menu-register");null==e||e.addEventListener("click",this.onRegister.bind(this)),this.checkUser()}onRegister(){this.popup.show()}showReg(){var e,t,s;null===(e=this.element.querySelector(".register"))||void 0===e||e.classList.add("active-reg"),null===(t=this.element.querySelector(".user-avatar"))||void 0===t||t.classList.remove("active-reg"),null===(s=this.element.querySelector(".start-game"))||void 0===s||s.classList.remove("active-reg")}showAvatar(){var e,t,s;null===(e=this.element.querySelector(".register"))||void 0===e||e.classList.remove("active-reg"),null===(t=this.element.querySelector(".user-avatar"))||void 0===t||t.classList.add("active-reg"),null===(s=this.element.querySelector(".start-game"))||void 0===s||s.classList.add("active-reg"),this.userService.get(this.currentUserId,(e=>{const t=this.element.querySelector(".user-name");t&&(t.innerHTML=e.name);const s=this.element.querySelector(".avatar-img__head");s&&(s.src=e.img),e.img||(s.src="../../assets/Ellipse2.png")}))}checkUser(){this.currentUserId?this.showAvatar():this.showReg()}}t.Header=o},20:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.localStorageUtil=void 0,t.localStorageUtil=new class{constructor(){this.defaultGameSettings={cardCount:6,cardType:"sw"},this.gameSettingsKey="gameSettings",this.accountKey="account"}getGameSettings(){return this.getData(this.gameSettingsKey)||this.defaultGameSettings}getAccount(){return this.getData(this.accountKey)}getData(e){return this.json=localStorage.getItem(e),null!=this.json?JSON.parse(this.json):null}setGameSettings(e){this.setData(this.gameSettingsKey,e)}setAccount(e){this.setData(this.accountKey,e)}setData(e,t){localStorage.setItem(e,JSON.stringify(t))}}},743:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Main=void 0;const i=s(583),n=s(957),a=s(197);class r extends i.BaseComponent{constructor(){super("main",["app"]),this.router=new n.Router(a.routes,this.element),this.router.run()}}t.Main=r},168:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WinnerPopup=void 0,s(171);const i=s(583);class n extends i.BaseComponent{constructor(){super("div",["popup_win"]),this.hide=()=>{this.element.classList.remove("open"),document.removeEventListener("keydown",this.onKeydown)},this.onKeydown=e=>{27===e.keyCode&&this.hide()},this.element.innerHTML='\n    <div class="popup__backdrop_win">\n        <div class="popup__content_win">\n          <div class="popup__text">\n              <h1>Congratulations !!!<br> You have finished the game!!!</h1>\n              <p class="result"></p>\n              <a href="#/about-game" class="ok-win">OK</a>\n          </div>\n        </div>\n    </div>\n    '}show(){this.element.classList.add("open"),document.addEventListener("keydown",this.onKeydown)}}t.WinnerPopup=n},53:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RegistrationPopup=void 0,s(667);const i=s(583);class n extends i.BaseComponent{constructor(e){super("div",["popup"]),this.userService=e,this.hide=()=>{this.element.classList.remove("open"),document.removeEventListener("keydown",this.onKeydown)},this.onKeydown=e=>{27===e.keyCode&&this.hide()},this.onBackdropClick=e=>{e.target.closest(".popup__content")||this.hide()},this.onRegistration=e=>{const t=this.collectUserData();this.userService.add(t),this.hide(),e.preventDefault()},this.onValidEmail=()=>{const e=new RegExp(`${/^(([^<>()\\[\]\\.,;:\s@"]+(\.[^<>()\\[\]\\.,;:\s@"]+)*)|(".+"))/.source}${/@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.source}`);this.emailTest=e.test(this.userEmailName.value),this.emailTest?(this.userEmailName.classList.remove("invalid"),this.userEmailName.classList.add("valid")):(this.userEmailName.classList.remove("valid"),this.userEmailName.classList.add("invalid")),this.disBtn()},this.onValidName=()=>{this.nameTest=/^[^0-9][^(~!@#$%*&()_—+=|:;"'`<>,.?\\/\\^\s)]{1,30}$/.test(this.userNameInput.value),this.nameTest?(this.userNameInput.classList.remove("invalid"),this.userNameInput.classList.add("valid")):(this.userNameInput.classList.remove("valid"),this.userNameInput.classList.add("invalid")),this.disBtn()},this.onValidLastName=()=>{this.lastNameTest=/^[^0-9][^(~!@#$%*&()_—+=|:;"'`<>,.?\\/\\^\s)]{1,30}$/.test(this.userLastNameInput.value),this.lastNameTest?(this.userLastNameInput.classList.remove("invalid"),this.userLastNameInput.classList.add("valid")):(this.userLastNameInput.classList.remove("valid"),this.userLastNameInput.classList.add("invalid")),this.disBtn()},this.element.innerHTML='\n    <div class="popup__backdrop">\n        <div class="popup__content">\n        <h1>Registr new Player</h1>\n          <div class="avatar">\n            <label class="avatar-label" for="input-filer__reader">\n              <img src="" height="200" width="200" class="avatar-img">\n            </label>\n            <input type="file" class="input-file__reader">\n          </div>\n          <div class="register-areas">\n              <form action="#" method="get" id="popup__reg">\n                <label for="name">First name</label>\n                <input id="user-name__input" type="text"\n                  name="name" value="" data-rule="name" maxlength="30" required>\n                <label for="Last name">Last name</label>\n                <input id="user-last-name__input" type="text"\n                  name="Last name" value="" data-rule="lastName" maxlength="30" required>\n                <label for="Email">E-mail</label>\n                <input id="user-email-name__input" type="email"\n                  name="Email" value="" data-rule="email" maxlength="30" required>\n                <div class="register-btns">\n                  <button class="add-user" disabled>add user</button>\n                  <button class="cancel">cancel</button>\n                </div>\n              </form>\n          </div>\n        </div>\n    </div>\n    ',this.addUserBtn=this.element.querySelector(".add-user"),this.userNameInput=this.element.querySelector("#user-name__input"),this.userLastNameInput=this.element.querySelector("#user-last-name__input"),this.userEmailName=this.element.querySelector("#user-email-name__input"),this.preview=this.element.querySelector(".avatar-img"),this.file=this.element.querySelector("input[type=file]"),this.preview.addEventListener("click",(()=>{this.file.click()})),this.file.addEventListener("change",(e=>{this.onAvatar(e)})),this.addUserBtn.addEventListener("click",this.onRegistration),this.userEmailName.addEventListener("change",this.onValidEmail),this.userNameInput.addEventListener("change",this.onValidName),this.userLastNameInput.addEventListener("change",this.onValidLastName);const t=this.element.querySelector(".cancel");null==t||t.addEventListener("click",this.hide);const s=this.element.querySelector(".popup__backdrop");null==s||s.addEventListener("click",this.onBackdropClick)}onAvatar(e){const t=null==e?void 0:e.target;if(t.files){const e=t.files[0],s=new FileReader;s.readAsDataURL(e),s.onload=()=>{"string"==typeof s.result&&(this.preview.src=s.result)}}this.file.value=""}show(){this.element.classList.add("open"),document.addEventListener("keydown",this.onKeydown)}disBtn(){this.nameTest&&this.lastNameTest&&this.emailTest?this.addUserBtn.disabled=!1:this.addUserBtn.disabled=!0}collectUserData(){const e=this.userNameInput.value,t=this.userLastNameInput.value,s=this.preview.src;return{name:e,lastName:t,email:this.userEmailName.value,img:s,score:0}}}t.RegistrationPopup=n},957:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Router=void 0,t.Router=class{constructor(e,t){this.routes=e,this.container=t}run(){window.onpopstate=this.onChangeRoute.bind(this),this.onChangeRoute()}onChangeRoute(){const e=this.routes.find((e=>e.path===window.location.hash.split("/")[1]));e?this.renderComponent(e.getComponent()):this.renderComponent(this.routes[0].getComponent())}renderComponent(e){this.container.innerHTML="",this.container.appendChild(e)}}},197:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.routes=void 0;const i=s(229),n=s(186),a=s(366),r=s(286);t.routes=[{path:"about-game",getComponent:()=>(new a.AboutGame).element},{path:"best-score",getComponent:()=>(new n.BestScore).element},{path:"game",getComponent:()=>(new i.Game).element},{path:"game-settings",getComponent:()=>(new r.GameSettings).element}]},981:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=void 0,s(580);const i=s(583);class n extends i.BaseComponent{constructor(){super("div",["timer"]),this.time=0,this.run=()=>{this.time=0,this.interval=setInterval((()=>{this.time+=1,this.rerender()}),1e3)},this.stop=()=>(clearInterval(this.interval),this.rerender(),this.time),this.element.innerHTML='\n      <span class="timer-text">\n        <span class="minutes">00</span>:<span class="seconds">00</span>\n      </span>\n    '}rerender(){this.element.innerHTML=this.getTime()}getTime(){const e=Math.floor(this.time/60),t=this.time%60;return`\n      <span class="timer-text">\n        <span class="minutes">${this.toTimeFormat(e)}</span>:<span class="seconds">${this.toTimeFormat(t)}</span>\n      </span>\n    `}toTimeFormat(e){return`${e<10?"0":""}${e}`}}t.Timer=n},680:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.delay=void 0,t.delay=function(e){return new Promise((t=>{setTimeout(t,e)}))}},874:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const i=s(963);t.UserService=class{constructor(){this.indexedDB=window.indexedDB,this.dbName="OverNovik",this.dbVersion=1,this.userStateName="usersStore"}connectDB(e){this.request=this.indexedDB.open(this.dbName,this.dbVersion),this.request.onsuccess=()=>{e(this.request.result)},this.request.onupgradeneeded=()=>{const t=this.request.result;t.objectStoreNames.contains(this.userStateName)||(this.store=this.createStore(t)),this.connectDB(e)}}createStore(e){const t=e.createObjectStore(this.userStateName,{keyPath:"id",autoIncrement:!0});return t.createIndex("user","user",{unique:!0}),t}add(e){this.connectDB((t=>{const s=t.transaction([this.userStateName],"readwrite").objectStore(this.userStateName).add(e);s.onsuccess=()=>{const e=s.result;i.stated.setUserId(e)}}))}get(e,t){this.connectDB((s=>{const i=s.transaction([this.userStateName],"readonly").objectStore(this.userStateName).get(e);i.onsuccess=()=>{const e=i.result;t(e)}}))}getAll(e){this.connectDB((t=>{const s=[],i=t.transaction([this.userStateName],"readonly").objectStore(this.userStateName).openCursor();i.onsuccess=()=>{const t=i.result;if(t){const e=t.value;s.push(e),t.continue()}else e(s)}}))}update(e){this.delete(e,this.add.bind(this))}delete(e,t){const s=e.id;this.connectDB((i=>{i.transaction([this.userStateName],"readwrite").objectStore(this.userStateName).delete(s).onsuccess=()=>{t&&t(e)}}))}}},963:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stated=void 0,t.stated=new class{constructor(){this.state={userId:0,gameSettings:{cardType:"",cardCount:3}},this.subscribers=[]}subscribe(e){this.subscribers.push(e)}callSubscribers(){this.subscribers.forEach((e=>e(this.state)))}setUserId(e){this.state.userId=+e,this.callSubscribers()}getState(){return this.state}setCardType(e){this.state.gameSettings.cardType=e}setCardCount(e){this.state.gameSettings.cardCount=e}getGameSettings(){return this.state.gameSettings}}}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,s),a.exports}s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{s(373);const e=s(752);window.onload=()=>{const t=document.body;if(!t)throw new Error("App root element not found");new e.App(t)}})()})();